import{c as L}from"./chunk-BQ55YN6H.js";import{a as B,b as h,c as W}from"./chunk-DXTANF2M.js";import{a as V,b as D,e as F,h as j}from"./chunk-G2YLY2U7.js";import{a as A}from"./chunk-75PX6TYH.js";import{$a as n,Ab as w,Bb as z,Ia as m,Ka as S,Na as T,Oa as l,Sa as i,Ta as e,Va as M,Wa as g,Xa as d,Y as C,a as f,ab as s,bb as k,db as E,ea as v,eb as P,fa as x,fb as O,hb as y,ib as I,jb as N,ua as r,va as p}from"./chunk-FUL3TK4O.js";function U(a,u){if(a&1&&(i(0,"div",6),n(1),e()),a&2){let t=d();r(),s(t.error)}}function q(a,u){if(a&1&&(i(0,"div",13)(1,"span",2),n(2,"meeting_room"),e(),i(3,"div")(4,"label"),n(5,"Guichet"),e(),i(6,"strong"),n(7),e()()()),a&2){let t=d(2);r(7),s(t.ticket.counterNumber)}}function G(a,u){if(a&1&&(i(0,"div",14)(1,"span",2),n(2,"campaign"),e(),i(3,"div")(4,"strong"),n(5,"C'est votre tour !"),e(),i(6,"p"),n(7),e()()()),a&2){let t=d(2);r(7),k("Veuillez vous rendre au guichet ",t.ticket.counterNumber,"")}}function H(a,u){if(a&1){let t=M();i(0,"button",16),g("click",function(){v(t);let o=d(2);return x(o.cancelTicket())}),i(1,"span",2),n(2,"cancel"),e(),n(3," Annuler mon ticket "),e()}}function R(a,u){if(a&1&&(i(0,"div",7)(1,"div",8)(2,"div",9),n(3),e(),i(4,"span"),n(5),e()(),i(6,"div",10)(7,"div",11)(8,"div",12)(9,"span",2),n(10,"category"),e(),i(11,"div")(12,"label"),n(13,"Service"),e(),i(14,"strong"),n(15),e()()(),i(16,"div",12)(17,"span",2),n(18,"schedule"),e(),i(19,"div")(20,"label"),n(21,"Position dans la file"),e(),i(22,"strong"),n(23),e()()(),i(24,"div",12)(25,"span",2),n(26,"timer"),e(),i(27,"div")(28,"label"),n(29,"Temps d'attente estim\xE9"),e(),i(30,"strong"),n(31),e()()(),i(32,"div",12)(33,"span",2),n(34,"access_time"),e(),i(35,"div")(36,"label"),n(37,"Cr\xE9\xE9 \xE0"),e(),i(38,"strong"),n(39),I(40,"date"),e()()(),m(41,q,8,1,"div",13),e(),m(42,G,8,1,"div",14)(43,H,4,0,"button",15),e()()),a&2){let t=d();r(3),s(t.ticket.ticketNumber),r(),T("badge ",t.getStatusClass(t.ticket.status),""),r(),k(" ",t.getStatusLabel(t.ticket.status)," "),r(10),s(t.getServiceLabel(t.ticket.serviceType)),r(8),s(t.ticket.queuePosition||"-"),r(8),k("~",t.ticket.estimatedWaitTime," min"),r(8),s(N(40,12,t.ticket.createdAt,"HH:mm")),r(2),l(41,t.ticket.counterNumber?41:-1),r(),l(42,t.ticket.status==="called"?42:-1),r(),l(43,t.ticket.status==="waiting"?43:-1)}}var it=(()=>{class a{constructor(t,c,o){this.route=t,this.ticketService=c,this.socketService=o,this.ticketNumber="",this.ticket=null,this.loading=!1,this.error="",this.subscriptions=[]}ngOnInit(){this.route.queryParams.subscribe(t=>{t.ticket&&(this.ticketNumber=t.ticket,this.searchTicket())}),this.subscriptions.push(this.socketService.onTicketUpdated().subscribe(t=>{this.ticket&&t._id===this.ticket._id&&(this.ticket=f(f({},this.ticket),t))}),this.socketService.onTicketCalled().subscribe(t=>{this.ticket&&t.ticket.id===this.ticket._id&&this.searchTicket()}))}ngOnDestroy(){this.ticket&&this.socketService.unsubscribeFromTicket(this.ticket._id),this.subscriptions.forEach(t=>t.unsubscribe())}searchTicket(){this.ticketNumber.trim()&&(this.loading=!0,this.error="",this.ticketService.getTicketByNumber(this.ticketNumber.toUpperCase()).subscribe({next:t=>{this.loading=!1,t.success&&t.data?(this.ticket&&this.socketService.unsubscribeFromTicket(this.ticket._id),this.ticket=t.data,this.socketService.subscribeToTicket(this.ticket._id)):(this.error="Ticket non trouv\xE9",this.ticket=null)},error:()=>{this.loading=!1,this.error="Ticket non trouv\xE9",this.ticket=null}}))}cancelTicket(){!this.ticket||!confirm("\xCAtes-vous s\xFBr de vouloir annuler ce ticket ?")||this.ticketService.cancelTicket(this.ticket._id).subscribe({next:t=>{t.success&&t.data&&(this.ticket=t.data)}})}getStatusLabel(t){return h[t]?.label||t}getStatusClass(t){return h[t]?.class||""}getServiceLabel(t){return B.find(c=>c.value===t)?.label||t}static{this.\u0275fac=function(c){return new(c||a)(p(L),p(W),p(A))}}static{this.\u0275cmp=C({type:a,selectors:[["app-ticket-status"]],standalone:!0,features:[y],decls:13,vars:5,consts:[[1,"ticket-status-page"],[1,"card","search-card"],[1,"material-icons"],[1,"search-form"],["type","text","placeholder","Entrez votre num\xE9ro de ticket (ex: G001)",3,"ngModelChange","keyup.enter","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],[1,"alert","alert-error"],[1,"card","ticket-details","fade-in"],[1,"ticket-header"],[1,"ticket-number-display"],[1,"ticket-body"],[1,"info-grid"],[1,"info-item"],[1,"info-item","highlight"],[1,"alert-called"],[1,"btn","btn-danger"],[1,"btn","btn-danger",3,"click"]],template:function(c,o){c&1&&(i(0,"div",0)(1,"div",1)(2,"h1")(3,"span",2),n(4,"search"),e(),n(5," Suivre mon Ticket "),e(),i(6,"div",3)(7,"input",4),O("ngModelChange",function(_){return P(o.ticketNumber,_)||(o.ticketNumber=_),_}),g("keyup.enter",function(){return o.searchTicket()}),e(),i(8,"button",5),g("click",function(){return o.searchTicket()}),i(9,"span",2),n(10),e()()(),m(11,U,2,1,"div",6),e(),m(12,R,44,15,"div",7),e()),c&2&&(r(7),E("ngModel",o.ticketNumber),r(),S("disabled",o.loading),r(2),s(o.loading?"sync":"search"),r(),l(11,o.error?11:-1),r(),l(12,o.ticket?12:-1))},dependencies:[z,w,j,V,D,F],styles:[".ticket-status-page[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.search-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#1a365d;margin-bottom:1.5rem}.search-form[_ngcontent-%COMP%]{display:flex;gap:.5rem}.search-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:1rem;border:2px solid #e2e8f0;border-radius:8px;font-size:1.125rem;text-transform:uppercase}.search-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#2b6cb0;outline:none}.search-form[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:1rem 1.5rem}.ticket-details[_ngcontent-%COMP%]{margin-top:1.5rem}.ticket-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:1rem;border-bottom:1px solid #e2e8f0;margin-bottom:1.5rem}.ticket-number-display[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#1a365d;letter-spacing:.05em}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin-bottom:1.5rem}.info-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem}.info-item[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#2b6cb0;margin-top:.25rem}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:#718096;font-size:.875rem}.info-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#1a202c}.info-item.highlight[_ngcontent-%COMP%]{grid-column:span 2;background:#ebf8ff;padding:1rem;border-radius:8px}.alert-called[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;background:linear-gradient(135deg,#38a169,#2f855a);color:#fff;padding:1.5rem;border-radius:12px;margin:1.5rem 0;animation:_ngcontent-%COMP%_pulse 2s infinite}.alert-called[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2.5rem}.alert-called[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.25rem}.alert-called[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:.25rem;opacity:.9}.alert-error[_ngcontent-%COMP%]{background:#fed7d7;color:#c53030;padding:1rem;border-radius:8px;margin-top:1rem}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1)}50%{transform:scale(1.02)}}@media (max-width: 480px){.info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.info-item.highlight[_ngcontent-%COMP%]{grid-column:span 1}}"]})}}return a})();export{it as TicketStatusComponent};
