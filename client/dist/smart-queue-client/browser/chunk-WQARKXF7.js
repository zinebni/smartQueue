import{a as y}from"./chunk-HKUJYTPE.js";import{a as k}from"./chunk-75PX6TYH.js";import{$a as n,Bb as P,Ia as x,Ja as C,La as S,Ma as E,Oa as u,Pa as O,Qa as m,Ra as g,Sa as i,Ta as e,Ua as b,Xa as p,Y as f,ab as s,bb as l,cb as h,hb as M,ua as r,va as v,x as _}from"./chunk-FUL3TK4O.js";var w=(a,d)=>d.service,T=(a,d)=>d._id;function I(a,d){if(a&1&&(i(0,"span",19),n(1),e()),a&2){let t=d.$implicit,o=p(4);C("data-service",t),r(),l(" ",o.getServiceLabel(t)," ")}}function A(a,d){if(a&1&&(i(0,"tr")(1,"td"),n(2),e(),i(3,"td"),n(4),e(),i(5,"td")(6,"div",18),m(7,I,2,2,"span",19,O),e()(),i(9,"td"),b(10,"span",20),n(11),e(),i(12,"td"),n(13),e(),i(14,"td"),n(15),e(),i(16,"td"),n(17),e()()),a&2){let t=d.$implicit;r(2),h("",t.firstName," ",t.lastName,""),r(2),s(t.counterNumber||"-"),r(3),g(t.services),r(3),E("online",t.isOnline),r(),l(" ",t.isOnline?"En ligne":"Hors ligne"," "),r(2),s((t.currentTicket==null?null:t.currentTicket.ticketNumber)||"-"),r(2),s(t.ticketsServedToday),r(2),l("",t.averageServiceTime," min")}}function D(a,d){if(a&1&&(i(0,"div",15)(1,"table")(2,"thead")(3,"tr")(4,"th"),n(5,"Agent"),e(),i(6,"th"),n(7,"Guichet"),e(),i(8,"th"),n(9,"Services"),e(),i(10,"th"),n(11,"Statut"),e(),i(12,"th"),n(13,"Ticket actuel"),e(),i(14,"th"),n(15,"Servis"),e(),i(16,"th"),n(17,"Temps moy."),e()()(),i(18,"tbody"),m(19,A,18,9,"tr",null,T),e()()()),a&2){let t=p(2);r(19),g(t.agents)}}function j(a,d){a&1&&(i(0,"p",21),n(1,"Aucun agent trouv\xE9"),e())}function F(a,d){if(a&1&&(i(0,"div",17)(1,"span",22),n(2),e(),i(3,"div",23),b(4,"div",24),e(),i(5,"span",25),n(6),e()()),a&2){let t=d.$implicit;r(2),s(t.label),r(2),S("width",t.percentage,"%"),r(2),s(t.count)}}function z(a,d){if(a&1&&(i(0,"div",3)(1,"div",4)(2,"span",2),n(3,"hourglass_empty"),e(),i(4,"div",5)(5,"span",6),n(6),e(),i(7,"span",7),n(8,"En attente"),e()()(),i(9,"div",8)(10,"span",2),n(11,"support_agent"),e(),i(12,"div",5)(13,"span",6),n(14),e(),i(15,"span",7),n(16,"En cours"),e()()(),i(17,"div",9)(18,"span",2),n(19,"check_circle"),e(),i(20,"div",5)(21,"span",6),n(22),e(),i(23,"span",7),n(24,"Termin\xE9s"),e()()(),i(25,"div",10)(26,"span",2),n(27,"confirmation_number"),e(),i(28,"div",5)(29,"span",6),n(30),e(),i(31,"span",7),n(32,"Total aujourd'hui"),e()()()(),i(33,"div",11)(34,"div",12)(35,"h3")(36,"span",2),n(37,"timer"),e(),n(38," Temps moyen d'attente "),e(),i(39,"div",13),n(40),e()(),i(41,"div",12)(42,"h3")(43,"span",2),n(44,"speed"),e(),n(45," Temps moyen de service "),e(),i(46,"div",13),n(47),e()(),i(48,"div",12)(49,"h3")(50,"span",2),n(51,"groups"),e(),n(52," Agents en ligne "),e(),i(53,"div",13),n(54),e()()(),i(55,"div",14)(56,"h2")(57,"span",2),n(58,"support_agent"),e(),n(59," Agents "),e(),x(60,D,21,0,"div",15)(61,j,2,0),e(),i(62,"div",14)(63,"h2")(64,"span",2),n(65,"category"),e(),n(66," Par service "),e(),i(67,"div",16),m(68,F,7,4,"div",17,w),e()()),a&2){let t=p();r(6),s(t.stats.overview.waiting),r(8),s(t.stats.overview.serving),r(8),s(t.stats.overview.completed),r(8),s(t.stats.overview.totalToday),r(10),l("",t.stats.performance.avgWaitTime," min"),r(7),l("",t.stats.performance.avgServiceTime," min"),r(7),h("",t.stats.agents.online," / ",t.stats.agents.total,""),r(6),u(60,t.agents.length?60:61),r(8),g(t.getServiceStats())}}function L(a,d){a&1&&(i(0,"div",26),n(1,"Chargement..."),e())}var H=(()=>{class a{constructor(t,o){this.statsService=t,this.socketService=o,this.stats=null,this.agents=[],this.subscriptions=[],this.serviceLabels={general:"G\xE9n\xE9ral",account:"Compte",loan:"Cr\xE9dit",registration:"Inscription",consultation:"Consultation",payment:"Paiement"}}ngOnInit(){this.socketService.joinRoom("admin"),this.loadStats(),this.loadAgents(),this.subscriptions.push(_(15e3).subscribe(()=>{this.loadStats(),this.loadAgents()})),this.subscriptions.push(this.socketService.onTicketCreated().subscribe(()=>this.loadStats()),this.socketService.onTicketUpdated().subscribe(()=>this.loadStats()))}ngOnDestroy(){this.socketService.leaveRoom("admin"),this.subscriptions.forEach(t=>t.unsubscribe())}loadStats(){this.statsService.getStats().subscribe({next:t=>{t.data&&(this.stats=t.data)}})}loadAgents(){this.statsService.getAgentStats().subscribe({next:t=>{t.data&&(this.agents=t.data)}})}getServiceStats(){if(!this.stats?.byService)return[];let t=Object.values(this.stats.byService).reduce((o,c)=>o+c,0)||1;return Object.entries(this.stats.byService).map(([o,c])=>({service:o,label:this.serviceLabels[o]||o,count:c,percentage:Math.round(c/t*100)}))}getServiceLabel(t){return this.serviceLabels[t]||t}static{this.\u0275fac=function(o){return new(o||a)(v(y),v(k))}}static{this.\u0275cmp=f({type:a,selectors:[["app-admin-dashboard"]],standalone:!0,features:[M],decls:10,vars:1,consts:[[1,"admin-dashboard"],[1,"dashboard-header"],[1,"material-icons"],[1,"stats-grid"],[1,"stat-card","waiting"],[1,"stat-content"],[1,"value"],[1,"label"],[1,"stat-card","serving"],[1,"stat-card","completed"],[1,"stat-card","total"],[1,"grid","grid-3"],[1,"card","perf-card"],[1,"perf-value"],[1,"card"],[1,"agents-table"],[1,"service-bars"],[1,"service-bar"],[1,"services-tags"],[1,"service-tag"],[1,"status-dot"],[1,"no-data"],[1,"service-name"],[1,"bar-container"],[1,"bar"],[1,"service-count"],[1,"loading"]],template:function(o,c){o&1&&(i(0,"div",0)(1,"div",1)(2,"h1")(3,"span",2),n(4,"dashboard"),e(),n(5," Tableau de Bord "),e(),i(6,"p"),n(7,"Mise \xE0 jour en temps r\xE9el"),e()(),x(8,z,70,9)(9,L,2,0),e()),o&2&&(r(8),u(8,c.stats?8:9))},dependencies:[P],styles:[".admin-dashboard[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.dashboard-header[_ngcontent-%COMP%]{margin-bottom:2rem}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#1a365d}.dashboard-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#718096}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1.5rem;border-radius:12px;color:#fff}.stat-card.waiting[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dd6b20,#c05621)}.stat-card.serving[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2b6cb0,#2c5282)}.stat-card.completed[_ngcontent-%COMP%]{background:linear-gradient(135deg,#38a169,#2f855a)}.stat-card.total[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1a365d,#2d3748)}.stat-card[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2.5rem;opacity:.9}.stat-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:block;font-size:2rem;font-weight:700}.stat-card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.875rem;opacity:.9}.perf-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#4a5568;margin-bottom:1rem}.perf-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#1a365d}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#1a365d;margin-bottom:1.5rem}.agents-table[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid #e2e8f0}th[_ngcontent-%COMP%]{background:#f7fafc;font-weight:600;color:#4a5568}.status-dot[_ngcontent-%COMP%]{display:inline-block;width:8px;height:8px;border-radius:50%;background:#cbd5e0;margin-right:.5rem}.status-dot.online[_ngcontent-%COMP%]{background:#38a169}.services-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.25rem}.service-tag[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500;white-space:nowrap}.service-tag[data-service=account][_ngcontent-%COMP%]{background:#bee3f8;color:#2c5282}.service-tag[data-service=loan][_ngcontent-%COMP%]{background:#fbd38d;color:#7c2d12}.service-tag[data-service=general][_ngcontent-%COMP%]{background:#c6f6d5;color:#22543d}.service-tag[data-service=registration][_ngcontent-%COMP%]{background:#fed7d7;color:#742a2a}.service-tag[data-service=consultation][_ngcontent-%COMP%]{background:#e9d8fd;color:#44337a}.service-tag[data-service=payment][_ngcontent-%COMP%]{background:#feebc8;color:#7c2d12}.service-bars[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.service-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.service-name[_ngcontent-%COMP%]{width:150px;font-weight:500}.bar-container[_ngcontent-%COMP%]{flex:1;height:24px;background:#e2e8f0;border-radius:12px;overflow:hidden}.bar[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#2b6cb0,#1a365d);border-radius:12px;transition:width .3s ease}.service-count[_ngcontent-%COMP%]{width:40px;text-align:right;font-weight:600}.no-data[_ngcontent-%COMP%], .loading[_ngcontent-%COMP%]{text-align:center;color:#a0aec0;padding:2rem}@media (max-width: 768px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.grid-3[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return a})();export{H as AdminDashboardComponent};
