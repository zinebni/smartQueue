import{Ca as a,Gb as u,Jb as h,M as o,P as l,U as c,m as i,sb as g,z as s}from"./chunk-VBPBWIK6.js";var S=(()=>{class n{constructor(t){this.http=t,this.apiUrl=`${h.apiUrl}/auth`,this.currentAgent=a(null),this.token=a(null),this.agent=g(()=>this.currentAgent()),this.loadFromStorage()}loadFromStorage(){let t=localStorage.getItem("token"),e=localStorage.getItem("agent");t&&e&&(this.token.set(t),this.currentAgent.set(JSON.parse(e)))}login(t,e){return this.http.post(`${this.apiUrl}/login`,{username:t,password:e}).pipe(o(r=>{r.success&&r.data&&(this.token.set(r.data.token),this.currentAgent.set(r.data.agent),localStorage.setItem("token",r.data.token),localStorage.setItem("agent",JSON.stringify(r.data.agent)))}))}logout(){return this.token()?this.http.post(`${this.apiUrl}/logout`,{}).pipe(o(()=>this.clearAuth()),s(()=>(this.clearAuth(),i({success:!0})))):(this.clearAuth(),i({success:!0}))}clearAuth(){this.token.set(null),this.currentAgent.set(null),localStorage.removeItem("token"),localStorage.removeItem("agent")}getMe(){return this.http.get(`${this.apiUrl}/me`).pipe(o(t=>{t.success&&t.data&&(this.currentAgent.set(t.data),localStorage.setItem("agent",JSON.stringify(t.data)))}))}getToken(){return this.token()}isLoggedIn(){return!!this.token()}isAdmin(){let t=this.currentAgent();return t?.role==="admin"||t?.role==="supervisor"}getRole(){return this.currentAgent()?.role||null}static{this.\u0275fac=function(e){return new(e||n)(c(u))}}static{this.\u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{S as a};
